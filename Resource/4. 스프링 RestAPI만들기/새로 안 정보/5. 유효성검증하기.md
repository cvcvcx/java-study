---
ë‚ ì§œ: 2024-01-05
ì£¼ì œ: Spring Boot REST API
ì„¤ëª…: ì„œë²„ ìš”ì²­ ê°ì²´ì˜ ìœ íš¨ì„±ì„ ê²€ì¦í•œë‹¤
---
> [!NOTE] ì‚¬ìš© ì‹œê¸°
>  - ì‚¬ìš©ìì˜ ìš”ì²­ì´ ì´ìƒí•˜ê²Œ ì˜¬ ë•Œ, 
>    ê·¸ ìš”ì²­ì´ ì œëŒ€ë¡œ ëœ ìš”ì²­ì¸ì§€ ì•„ë‹Œì§€ íŒë³„í•´ì„œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ í•´ì•¼í•œë‹¤.


> [!tip] ì‚¬ìš©ë°©ë²•
> - spring-boot-starter-validationë¥¼ build.gradleì— ì¶”ê°€í•˜ê³ 
> - @Vaild ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì„œ ìš”ì²­ì„ ê²€ì¦í•œë‹¤.
> - @Size @Past ì™€ ê°™ì€ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ê²€ì¦ ê¸°ì¤€ì„ ì •í•  ìˆ˜ ìˆë‹¤.
> - ë˜í•œ, ì´ì „ì— ë§Œë“  ì˜ˆì™¸ì²˜ë¦¬ ì •ë³´ í•¸ë“¤ëŸ¬([[4. ì˜ˆì™¸ì²˜ë¦¬ ì •ë³´ ì»¤ìŠ¤í…€í•˜ê¸°]]ì°¸ì¡°)ë¥¼ í†µí•´ 
>   êµ¬ì²´ì ì¸ ë©”ì„¸ì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ ë„˜ê²¨ì„œ, ì¡°ê±´ì„ ì•Œë ¤ì¤„ ìˆ˜ ìˆë‹¤.


# ğŸš€ êµ¬ì²´ì ì¸ ì‚¬ìš©ë°©ë²•
### 1. spring-boot-starter-validation ì¶”ê°€
 ```gradle
 // build.gradle
 implementation 'org.springframework.boot:spring-boot-starter-validation'
 ```

### 2. ë§¤ê°œë³€ìˆ˜ì— @Valid ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
```java
@PostMapping("/users")  
public ResponseEntity<User> createUser(@Valid @RequestBody User user){  
    User save = service.save(user);  
    URI location =  
            ServletUriComponentsBuilder.fromCurrentRequest()  
                                         .path("/{id}")  
                                         .buildAndExpand(save.getId())  
                                         .toUri();  
    return ResponseEntity.created(location).build();  
}
```

### 3. Userê°ì²´ì— ì¡°ê±´ ê¸°ì¤€ ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
```java
@Getter  
@Setter  
@NoArgsConstructor  
@AllArgsConstructor  
@ToString  
public class User {  
    private Integer id;  
    //ìµœì†Œ 2ìì´ìƒì€ ì…ë ¥í•´ì•¼í•œë‹¤.
    @Size(min = 2)  
    private String name;  
    // í˜„ì¬ì¼ ê¸°ì¤€ ê³¼ê±°ë§Œ ì„ íƒ ê°€ëŠ¥í•˜ë‹¤
    @Past  
    private LocalDate birthDate;  
}
```

ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.
![](https://i.imgur.com/dQiSV4q.png)

- í•˜ì§€ë§Œ ë””í…Œì¼ì—ì„œ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ë¶€ë¶„ì´ ì˜ëª»ë˜ì—ˆëŠ”ì§€ ì•Œë ¤ì£¼ì—ˆìœ¼ë©´ ì¢‹ê² ë‹¤.
- ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ ì´ì „ì— ë§Œë“¤ì—ˆë˜ ì»¤ìŠ¤í…€ì—ëŸ¬í•¸ë“¤ëŸ¬ë¥¼ ìˆ˜ì •í•œë‹¤.
### 4. ì»¤ìŠ¤í…€ì—ëŸ¬í•¸ë“¤ëŸ¬ì— ì—ëŸ¬ì²˜ë¦¬ ì˜¤ë²„ë¼ì´ë“œ êµ¬í˜„
```java
// ë©”ì„œë“œì˜ ì¸ìê°€ ìœ íš¨í•˜ì§€ ì•Šì„ ë•Œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì²˜ë¦¬ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•´ì„œ êµ¬í˜„í•œë‹¤.
@Override  
protected ResponseEntity<Object> handleMethodArgumentNotValid(MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatusCode status, WebRequest request) {  
    ErrorDetails errorDetails =  
            new ErrorDetails(LocalDateTime.now(),  
                    ex.getMessage(),  
                    request.getDescription(false));  
    return new ResponseEntity<>(errorDetails, HttpStatus.NOT_FOUND);  
}
```
ìˆ˜ì •í•œë’¤ ìš”ì²­ì„ ë‹¤ì‹œ ë³´ë‚´ë©´ ì•„ë˜ì™€ ê°™ì´ ë©”ì„¸ì§€ê°€ ë„ì°©í•œë‹¤
```
"message": "Validation failed for argument [0] in public org.springframework.http.ResponseEntity<com.in28minutes.rest.webservices.restfulwebservices.user.User> com.in28minutes.rest.webservices.restfulwebservices.user.UserResource.createUser(com.in28minutes.rest.webservices.restfulwebservices.user.User): [Field error in object 'user' on field 'birthDate': rejected value [2099-01-05]; codes [Past.user.birthDate,Past.birthDate,Past.java.time.LocalDate,Past]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [user.birthDate,birthDate]; arguments []; default message [birthDate]]; default message [ê³¼ê±° ë‚ ì§œì—¬ì•¼ í•©ë‹ˆë‹¤]] ",
```
- ìœ„ì™€ ê°™ì´, ì—ëŸ¬ê°€ ì–´ë–¤ë¶€ë¶„ì—ì„œ ë°œìƒí–ˆëŠ”ì§€, ì–´ë–»ê²Œ ìˆ˜ì •í•´ì•¼í•˜ëŠ”ì§€ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê³ ìˆë‹¤.
- í•˜ì§€ë§Œ ë„ˆë¬´ ì •ë³´ê°€ ë§ì•„ì„œ ì–´ë–¤ ë¶€ë¶„ì´ ë¬¸ì œì¸ì§€ íŒŒì•…í•˜ê¸° í˜ë“¬
- ìœ„ ë©”ì„¸ì§€ë¥¼ ì»¤ìŠ¤í…€í•´ì„œ ì•Œì•„ë³´ê¸° ì‰½ê²Œ ë§Œë“¤ì

### 5. ì—ëŸ¬ ë©”ì„¸ì§€ ì»¤ìŠ¤í…€
```java
//User.java
@Getter  
@Setter  
@NoArgsConstructor  
@AllArgsConstructor  
@ToString  
public class User {  
    private Integer id;  
    //ë©”ì„¸ì§€ë¥¼ ì¶”ê°€í•´ì„œ ì–´ë–¤ ì˜¤ë¥˜ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì¤„ì§€ ì•Œë ¤ì¤€ë‹¤
    @Size(min = 2,message = "ì´ë¦„ì€ ë‘ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!")  
    private String name;  
    @Past(message = "ìƒì¼ì€ ì§€ê¸ˆë³´ë‹¤ ë¯¸ë˜ì¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!")  
    private LocalDate birthDate;  
}
```

```java

@Override  
protected ResponseEntity<Object> handleMethodArgumentNotValid(MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatusCode status, WebRequest request) {  
// exì—ëŠ” FieldErrorë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œê°€ ìˆê³ , ê·¸ê³³ì—ì„œ ì§€ì •í•œ ë””í´íŠ¸ë©”ì„¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì¤„ ìˆ˜ ìˆë‹¤.
    ErrorDetails errorDetails =  
            new ErrorDetails(LocalDateTime.now(),  
                    ex.getFieldError().getDefaultMessage(),  
                    request.getDescription(false));  
    return new ResponseEntity<>(errorDetails, HttpStatus.NOT_FOUND);  
}
//CustomizedResponseErrorHandler.java
```

![](https://i.imgur.com/gVs8kq7.png)


> [!warning] ì£¼ì˜ ì‚¬í•­

