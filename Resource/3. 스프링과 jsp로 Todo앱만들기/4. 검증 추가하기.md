> 검증은 필수다. 검증이 없으면 빈 데이터가 들어와도 모르고, 데이터베이스를 임의로 수정하는 코드를 집어넣어도 모를 수도 있다. 
> 이번에는 스프링 jsp 환경에서 검증을 추가하는 방법을 알아보도록 한다.

# 📙 사전작업
- `spring boot vaildator starter`를 추가한다.

# 🚀 name의 문제점
 - 지금은 `form` 항목에 몇가지 없어서 괜찮지만, 나중에 항목이 늘어나면 일일히 관리하기 힘들어진다.
 - 그래서 Bean 객체를 바로 form으로 받을 수 있는 방법이 없을까?
 - 해서 나온게 양방향바인딩이라는 방법이다.

## 📚 양방향 바인딩
> 객체를 form에서 바로 받기 위해서는 어떻게 해야할까?
> form에서 받는 데이터가 어떤 객체인지 제대로 알아야한다.

1. 스프링 폼 라이브러리 doc을 구글에 검색한다.
2. 이후 공식문서로 들어가서 필요한 태그를 가져온다.
3. 태그를 jsp 제일 상단에 추가한다. 필요한 사전 작업은 이걸로 끝이다.

### 🎮 Controller
> 양방향 데이터 바인딩을 하기 위해서, 컨트롤러를 수정한다.

```java
//controller의 add-todo부분
@PostMapping("add-todo")  
//아래와 같이 Model이 먼저오게 바꾸고, Todo를 뒤로가게 수정한다.
// 그리고 todo에서 설명을 받아와 새로 투두에 적용시킨다.
public String addNewTodo(ModelMap map, Todo todo){  
    String name = (String) map.get("name");  
    log.debug(todo.getDescription());  
    todoService.addTodo(name,todo.getDescription(), LocalDate.now().plusYears(1),false);  
    return "redirect:list-todos";  
}
```

이후 jsp파일도 수정한다
### 🎥 JSP

```jsp
<%@ taglib prefix="c" uri="jakarta.tags.core" %>  
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>  
  
    <!DOCTYPE html>  
    <html lang="en">  
  
    <head>  
        <link rel="stylesheet" href="webjars/bootstrap/5.1.3/css/bootstrap.min.css">  
        <meta charset="UTF-8">  
        <title>Add Todo page</title>  
    </head>  
  
    <body>  
        <div class="container">  
            <h1>Enter Todo Details</h1>  
            ///////////////////////////
            <form:form method="post" modelAttribute="todo">  
                Description : <form:input type="text" path="description" required="required" />  
                <form:input type="hidden" path="id" />  
                <form:input type="hidden" path="done" />  
                <input type="submit" class="btn btn-success" />  
            </form:form>  
        </div>  
        <script src="webjars/bootstrap/5.1.3/js/bootstrap.min.js"></script>  
        <script src="webjars/jquery/3.6.0/jquery.min.js"></script>  
  
    </body>  
  
    </html>
```
- `form` 태그를 `form:form`태그로 변경하고, 그 안에 있는 `input`들의 `name`을 `path`로 변경하여 바인딩한다.
- `input`도 `form:input`태그로 다 변경해준다.

> 문제가 발생했을 때는, 항상 로그부터 참고해야한다.

#### ❓문제발생
- 에러가 발생했다. 일단 로그를 확인한다.
- ![](https://i.imgur.com/jPp3Tme.png)
- 로그를 긁어서 `chatgpt`에게 전달하면 대부분 에러를 해결할 수 있다.
- 위 에러는 `todo`라는 객체가 존재하지 않는다는 에러이다
- 처음에 왜 객체가 없는거지 하고 당황했지만, 사실 당연한 결과이다.
- `Controller`에서 해당 뷰로 넘어갈 때, `Todo`객체를 생성해서 넘기지 않았기 때문에, `Model`에 해당 객체가 존재하지 않는다는 뜻이다.
#### ✅ 문제 해결
> 처음 투두 추가 뷰로 넘어갈 때 모델에 Todo를 추가한다.
```java
@RequestMapping(value = "add-todo",method = RequestMethod.GET)  
public String showNewTodoPage(ModelMap map){  
    String name = (String) map.get("name");  
    Todo todo = new Todo(0, name, "", LocalDate.now()  
                                               .plusYears(1), false);  
    map.put("todo",todo);  
    return "todo";  
}
```
